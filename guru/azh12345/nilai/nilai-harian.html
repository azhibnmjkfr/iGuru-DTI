<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>Nilai Harian - iGuru-DTI</title>
    <meta name="description" content="Data nilai harian siswa - Bahasa Inggris MTsT Daarut Tahfizh Al-Ikhlas">
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><rect width='100' height='100' rx='20' fill='%230a2540'/><text x='50' y='70' font-size='70' text-anchor='middle' fill='%23b68b40' font-family='Arial' font-weight='bold'>iG</text></svg>">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        body { 
            background: linear-gradient(135deg, #f1f5f9 0%, #e9eef3 100%);
            color: #1e293b; 
            line-height: 1.5; 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
        }
        :root { 
            --navy: #0a2540; 
            --slate: #5f6b7a; 
            --gold: #b68b40; 
            --light: #f1f5f9; 
            --white: #ffffff; 
            --dark: #1e293b; 
            --shadow: 0 10px 30px -10px rgba(0,0,0,0.15);
            --shadow-hover: 0 20px 40px -15px rgba(10,37,64,0.25);
        }
        html { scroll-behavior: smooth; }
        .container { 
            max-width: 1400px; 
            margin: 0 auto; 
            padding: 1.5rem; 
            width: 100%; 
            flex: 1; 
            position: relative; 
        }
        .header {
            display: flex;
            align-items: center;
            gap: 1.5rem;
            background: var(--white);
            padding: 1.2rem 2rem;
            border-radius: 60px;
            box-shadow: var(--shadow);
            margin-bottom: 2rem;
            flex-wrap: wrap;
            border: 1px solid rgba(255,255,255,0.5);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }
        .header::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--gold), var(--navy));
        }
        .back-btn {
            background: var(--navy);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            text-decoration: none;
            transition: all 0.3s ease;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }
        .back-btn:hover { 
            background: #1d3a5c; 
            transform: translateX(-5px) scale(1.05);
            box-shadow: 0 8px 20px rgba(10,37,64,0.3);
        }
        .back-btn i { transition: transform 0.3s ease; }
        .back-btn:hover i { transform: translateX(-3px); }
        .title { 
            font-size: 2rem; 
            color: var(--navy); 
            font-weight: 700;
            background: linear-gradient(135deg, var(--navy), #1d3a5c);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .title i { 
            color: var(--gold);
            -webkit-text-fill-color: initial;
            font-size: 2.2rem;
        }
        .title span { 
            color: var(--slate); 
            font-size: 0.9rem; 
            background: #f1f5f9; 
            padding: 0.3rem 1rem; 
            border-radius: 40px; 
            margin-left: 1rem;
            -webkit-text-fill-color: initial;
            font-weight: 500;
            display: inline-flex;
            align-items: center;
            gap: 0.3rem;
        }
        .info-card {
            background: var(--white);
            border-radius: 40px;
            padding: 1.8rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow);
            display: flex;
            flex-wrap: wrap;
            gap: 3rem;
            align-items: center;
            border: 1px solid rgba(255,255,255,0.5);
            position: relative;
            overflow: hidden;
        }
        .info-card::after {
            content: '';
            position: absolute;
            right: 0;
            top: 0;
            width: 200px;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(182, 139, 64, 0.05));
            pointer-events: none;
        }
        .info-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex: 1 1 200px;
        }
        .info-icon {
            background: linear-gradient(135deg, var(--navy), #1d3a5c);
            color: white;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 8px 15px -5px rgba(10,37,64,0.2);
            border: 2px solid var(--gold);
        }
        .info-text h4 { 
            font-size: 0.85rem; 
            color: var(--slate); 
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }
        .info-text p { 
            font-size: 1.6rem; 
            color: var(--navy); 
            font-weight: 700;
            line-height: 1.2;
        }
        .filter-bar {
            display: flex;
            flex-wrap: wrap;
            gap: 0.8rem;
            background: var(--white);
            padding: 1.2rem;
            border-radius: 50px;
            margin-bottom: 1.5rem;
            align-items: center;
            box-shadow: var(--shadow);
            border: 2px solid #e9eef3;
        }
        .filter-input, .filter-select {
            padding: 0.9rem 1.2rem;
            border: 2px solid #e2e8f0;
            border-radius: 50px;
            font-size: 0.95rem;
            background: white;
            flex: 1 1 200px;
            transition: all 0.3s ease;
        }
        .filter-input:focus, .filter-select:focus { 
            border-color: var(--gold); 
            outline: none;
            box-shadow: 0 0 0 4px rgba(182, 139, 64, 0.1);
            transform: translateY(-2px);
        }
        .filter-input:hover, .filter-select:hover {
            border-color: var(--navy);
        }
        .filter-btn, .reset-btn {
            padding: 0.9rem 2rem;
            border-radius: 50px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
        }
        .filter-btn {
            background: var(--navy);
            color: white;
        }
        .filter-btn:hover { 
            background: #1d3a5c; 
            transform: translateY(-2px);
            box-shadow: 0 8px 15px -5px rgba(10,37,64,0.3);
        }
        .reset-btn {
            background: #e2e8f0;
            color: var(--dark);
        }
        .reset-btn:hover { 
            background: #cbd5e1; 
            transform: translateY(-2px);
        }
        .table-container {
            overflow-x: auto;
            overflow-y: auto;
            max-height: 600px;
            border-radius: 30px;
            border: 2px solid #edf2f7;
            background: white;
            position: relative;
            scrollbar-width: thin;
            scrollbar-color: var(--gold) #e9eef3;
            -webkit-overflow-scrolling: touch;
            box-shadow: var(--shadow);
        }
        .table-container::-webkit-scrollbar { width: 8px; height: 8px; }
        .table-container::-webkit-scrollbar-track { background: #e9eef3; border-radius: 10px; }
        .table-container::-webkit-scrollbar-thumb { background: var(--gold); border-radius: 10px; transition: all 0.3s ease; }
        .table-container::-webkit-scrollbar-thumb:hover { background: var(--navy); }
        table { width: 100%; border-collapse: separate; border-spacing: 0; min-width: 1400px; font-size: 0.9rem; }
        
        /* FIXED STICKY HEADER - SATU BLOCK UTUH */
        thead {
            position: sticky;
            top: 0;
            z-index: 30;
            background: transparent;
        }
        .main-header th,
        .sub-header th {
            position: static;
        }
        .main-header th {
            background: var(--navy);
            color: white;
            padding: 1rem 0.8rem;
            font-weight: 600;
            font-size: 0.95rem;
            text-align: center;
            white-space: nowrap;
            border-bottom: 3px solid var(--gold);
        }
        .sub-header th {
    background: var(--navy);
    color: rgba(255,255,255,0.9);
    padding: 0.8rem 0.5rem;
    font-weight: 500;
    font-size: 0.85rem;
    text-align: center;
    white-space: nowrap;
    border-bottom: 2px solid var(--gold);
}
        th:first-child, th:nth-child(2), th:nth-child(3) { background: var(--navy); }
        .sub-header th:first-child, 
.sub-header th:nth-child(2), 
.sub-header th:nth-child(3) {
    background: var(--navy);
}
        .nh-group th { border-left: 1px solid rgba(255,255,255,0.1); border-right: 1px solid rgba(255,255,255,0.1); }
        tbody tr { cursor: pointer; transition: all 0.2s ease; background: white; }
        tbody tr:nth-child(even) { background: #f8fafc; }
        tbody tr:hover { background: linear-gradient(135deg, #e9eef3, #f8fafc); transform: scale(1.001); box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        td { padding: 0.9rem 0.8rem; border-bottom: 1px solid #e2e8f0; white-space: nowrap; transition: all 0.2s ease; }
        td:first-child { font-weight: 600; color: var(--navy); background: rgba(10, 37, 64, 0.02); }
        td:nth-child(2) { font-weight: 500; }
        .nilai-baik { color: #10b981; font-weight: 600; }
        .nilai-cukup { color: #f59e0b; font-weight: 500; }
        .nilai-kurang { color: #ef4444; font-weight: 500; }
        td:last-child { background: rgba(182, 139, 64, 0.05); font-weight: 700; color: var(--navy); border-left: 2px solid var(--gold); }
        #backToTop {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            background: var(--navy);
            color: white;
            width: 55px;
            height: 55px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.8rem;
            cursor: pointer;
            border: none;
            box-shadow: var(--shadow-hover);
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s ease;
            z-index: 100;
            border: 2px solid var(--gold);
        }
        #backToTop.show { opacity: 1; visibility: visible; }
        #backToTop:hover { background: #1d3a5c; transform: translateY(-5px) scale(1.05); box-shadow: 0 15px 30px -10px rgba(10,37,64,0.4); }
        .toast {
            position: fixed;
            bottom: 2rem;
            left: 2rem;
            background: var(--navy);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 50px;
            box-shadow: var(--shadow-hover);
            display: flex;
            align-items: center;
            gap: 0.8rem;
            transform: translateY(100px);
            opacity: 0;
            transition: all 0.3s ease;
            z-index: 2000;
            border-left: 4px solid var(--gold);
        }
        .toast.show { transform: translateY(0); opacity: 1; }
        .toast i { color: var(--gold); font-size: 1.2rem; }
        .loading-spinner { display: inline-block; width: 40px; height: 40px; border: 4px solid #e9eef3; border-top-color: var(--gold); border-radius: 50%; animation: spin 1s linear infinite; }
        @keyframes spin { to { transform: rotate(360deg); } }
        .empty-state { text-align: center; padding: 3rem !important; }
        .empty-state i { font-size: 3rem; color: var(--gold); margin-bottom: 1rem; opacity: 0.5; }
        .empty-state p { color: var(--slate); font-size: 1rem; }
        @media (max-width: 768px) {
            .container { padding: 1rem; }
            .header { flex-direction: column; text-align: center; padding: 1.2rem; }
            .title { font-size: 1.5rem; flex-wrap: wrap; justify-content: center; }
            .title span { margin: 0.5rem 0 0; width: 100%; }
            .filter-bar { flex-direction: column; border-radius: 30px; }
            .filter-btn, .reset-btn { width: 100%; }
            .info-card { flex-direction: column; gap: 1.5rem; align-items: stretch; }
            .info-item { justify-content: center; }
        }
        @media print {
            .filter-bar, .back-btn, #backToTop, .toast { display: none !important; }
            .table-container { max-height: none; overflow: visible; }
            thead { position: static; }
        }
    </style>
</head>
<body>
    <div class="toast" id="toast"><i class="fas fa-check-circle"></i><span id="toastMessage">Memuat data...</span></div>
    <div class="container">
        <div class="header">
            <a href="https://azhibnmjkfr.github.io/iGuru-DTI/guru/azh12345/azh12345.html" class="back-btn"><i class="fas fa-arrow-left"></i></a>
            <div class="title"><i class="fas fa-book-open"></i> Nilai Harian<span><i class="fas fa-calendar-alt"></i> Semester Genap 2025/2026</span></div>
        </div>
        <div class="info-card">
            <div class="info-item"><div class="info-icon"><i class="fas fa-users"></i></div><div class="info-text"><h4>Total Siswa</h4><p id="totalData"><i class="fas fa-spinner fa-spin"></i></p></div></div>
            <div class="info-item"><div class="info-icon"><i class="fas fa-layer-group"></i></div><div class="info-text"><h4>Kelas</h4><p id="totalKelas"><i class="fas fa-spinner fa-spin"></i></p></div></div>
            <div class="info-item"><div class="info-icon"><i class="fas fa-chart-line"></i></div><div class="info-text"><h4>Rata-rata Kelas</h4><p id="rataRata"><i class="fas fa-spinner fa-spin"></i></p></div></div>
        </div>
        <div class="filter-bar">
            <i class="fas fa-search" style="color: var(--slate); margin-left: 0.5rem;"></i>
            <input type="text" class="filter-input" id="searchNama" placeholder="Cari nama siswa...">
            <select class="filter-select" id="filterKelas">
                <option value="all">Semua Kelas</option><option value="8A">Kelas 8A</option><option value="9A">Kelas 9A</option><option value="9B">Kelas 9B</option><option value="9C">Kelas 9C</option><option value="9D">Kelas 9D</option>
            </select>
            <button class="filter-btn" id="applyFilter"><i class="fas fa-filter"></i> Terapkan</button>
            <button class="reset-btn" id="resetFilter"><i class="fas fa-undo-alt"></i> Reset</button>
        </div>
        <div class="table-container" id="tableContainer">
            <table id="nilaiTable">
                <thead id="tableHeader"></thead>
                <tbody id="tableBody"><tr><td colspan="30" class="empty-state"><div class="loading-spinner"></div><p>Memuat data nilai harian...</p></td></tr></tbody>
            </table>
        </div>
        <button id="backToTop" title="Kembali ke atas"><i class="fas fa-arrow-up"></i></button>
    </div>
    <script>
        const SPREADSHEET_ID = '1YlGB2Kiu0BOtWjRXgm7NwcQgxO6K9crzPXuevcasvjc';
        const SHEET_NAME = 'Nilai_Harian';
        const URL = `https://docs.google.com/spreadsheets/d/${SPREADSHEET_ID}/gviz/tq?tqx=out:csv&sheet=${SHEET_NAME}`;
        const HEADER_STRUCTURE = {
            main: ['NISN','Nama Siswa','Kelas','NH₁ (BAB 1)','NH₂ (BAB 2)','NH₃ (BAB 3)','NH₄ (BAB 4)','RATA-RATA'],
            sub: ['RESP','TASK','EVAL','RESP','TASK','EVAL','RESP','TASK','EVAL','RESP','TASK','EVAL']
        };
        let originalData = { headers: HEADER_STRUCTURE, rows: [] };
        let currentData = { headers: HEADER_STRUCTURE, rows: [] };
        const toast = document.getElementById('toast');
        const toastMessage = document.getElementById('toastMessage');
        function showToast(message, isSuccess = true) {
            toastMessage.textContent = message;
            toast.classList.add('show');
            setTimeout(() => { toast.classList.remove('show'); }, 3000);
        }
        async function fetchData() {
            try {
                showToast('Memuat data nilai harian...');
                const response = await fetch(URL);
                const csvText = await response.text();
                parseData(csvText);
            } catch (error) {
                console.error('Error fetching data:', error);
                document.getElementById('tableBody').innerHTML = `<tr><td colspan="30" class="empty-state"><i class="fas fa-exclamation-circle"></i><p>Gagal memuat data. Periksa koneksi internet Anda.</p></td></tr>`;
                showToast('Gagal memuat data', false);
            }
        }
        function parseData(csvText) {
            const lines = csvText.trim().split('\n');
            if (lines.length < 3) {
                document.getElementById('tableBody').innerHTML = `<tr><td colspan="30" class="empty-state"><i class="fas fa-database"></i><p>Data tidak ditemukan</p></td></tr>`;
                return;
            }
            const dataRows = lines.slice(2).map(line => { return line.split(',').map(cell => cell.replace(/"/g, '').trim()); }).filter(row => row.length >= 16);
            originalData.rows = dataRows;
            currentData.rows = [...dataRows];
            renderTable();
            updateInfo();
            showToast(`Berhasil memuat ${dataRows.length} data siswa`);
        }
        function renderTable() {
            const thead = document.getElementById('tableHeader');
            const tbody = document.getElementById('tableBody');
            if (!currentData.rows || currentData.rows.length === 0) {
                thead.innerHTML = '';
                tbody.innerHTML = `<tr><td colspan="30" class="empty-state"><i class="fas fa-users-slash"></i><p>Tidak ada data siswa</p></td></tr>`;
                return;
            }
            let headerHtml = '<tr class="main-header">';
            headerHtml += `<th rowspan="2"><i class="fas fa-id-card"></i> NISN</th><th rowspan="2"><i class="fas fa-user-graduate"></i> Nama Siswa</th><th rowspan="2"><i class="fas fa-layer-group"></i> Kelas</th>`;
            headerHtml += `<th colspan="3" class="nh-group"><i class="fas fa-book"></i> NH₁ (BAB 1)</th><th colspan="3" class="nh-group"><i class="fas fa-book"></i> NH₂ (BAB 2)</th><th colspan="3" class="nh-group"><i class="fas fa-book"></i> NH₃ (BAB 3)</th><th colspan="3" class="nh-group"><i class="fas fa-book"></i> NH₄ (BAB 4)</th><th rowspan="2"><i class="fas fa-chart-line"></i> RATA-RATA</th>`;
            headerHtml += '</tr><tr class="sub-header">';
            for (let i = 0; i < 4; i++) { headerHtml += `<th>RESP</th><th>TASK</th><th>EVAL</th>`; }
            headerHtml += '</tr>';
            thead.innerHTML = headerHtml;
            tbody.innerHTML = currentData.rows.map(row => {
                while (row.length < 16) row.push('-');
                const formatNilai = (nilai) => {
                    const num = parseFloat(nilai);
                    if (isNaN(num)) return `<td>-</td>`;
                    let className = '';
                    if (num >= 85) className = 'nilai-baik';
                    else if (num >= 70) className = 'nilai-cukup';
                    else if (num > 0) className = 'nilai-kurang';
                    return `<td class="${className}">${num}</td>`;
                };
                return `<tr data-nisn="${row[0]}"><td><i class="fas fa-id-card" style="color: var(--gold); margin-right: 0.3rem;"></i> ${row[0] || '-'}</td><td><i class="fas fa-user" style="color: var(--navy); margin-right: 0.3rem;"></i> ${row[1] || '-'}</td><td><span class="kelas-badge" style="background: #e9eef3; padding: 0.2rem 1rem; border-radius: 50px; font-size: 0.8rem;">${row[2] || '-'}</span></td>${formatNilai(row[3])}${formatNilai(row[4])}${formatNilai(row[5])}${formatNilai(row[6])}${formatNilai(row[7])}${formatNilai(row[8])}${formatNilai(row[9])}${formatNilai(row[10])}${formatNilai(row[11])}${formatNilai(row[12])}${formatNilai(row[13])}${formatNilai(row[14])}<td><strong>${parseFloat(row[15]).toFixed(2) || '-'}</strong></td></tr>`;
            }).join('');
            document.querySelectorAll('#tableBody tr').forEach(row => { row.addEventListener('click', () => { const nisn = row.dataset.nisn; if (nisn) showDetailSiswa(nisn); }); });
        }
        function showDetailSiswa(nisn) {
            const siswa = currentData.rows.find(row => row[0] === nisn);
            if (!siswa) return;
            const nilai = siswa.slice(3, 15).map(Number).filter(n => !isNaN(n));
            const rataRata = nilai.length ? (nilai.reduce((a, b) => a + b, 0) / nilai.length).toFixed(2) : '-';
            const nilaiTertinggi = nilai.length ? Math.max(...nilai) : '-';
            const nilaiTerendah = nilai.length ? Math.min(...nilai) : '-';
            const detailHtml = `<div style="background: #f8fafc; border-radius: 24px; padding: 1.5rem; margin-bottom: 1.5rem;"><table style="width:100%;"><tr><td style="font-weight:600; width:120px;"><i class="fas fa-id-card" style="color: var(--gold);"></i> NISN</td><td><strong>${siswa[0]}</strong></td></tr><tr><td style="font-weight:600;"><i class="fas fa-user" style="color: var(--gold);"></i> Nama</td><td><strong>${siswa[1]}</strong></td></tr><tr><td style="font-weight:600;"><i class="fas fa-layer-group" style="color: var(--gold);"></i> Kelas</td><td><span style="background: #e9eef3; padding: 0.2rem 1rem; border-radius: 50px;">${siswa[2]}</span></td></tr></table></div><div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 1rem; margin-bottom: 1.5rem;"><div style="background: linear-gradient(135deg, #0a2540, #1d3a5c); color: white; padding: 1rem; border-radius: 20px; text-align: center;"><div style="font-size: 0.8rem; opacity: 0.8;">Rata-rata</div><div style="font-size: 1.8rem; font-weight: 700; color: var(--gold);">${rataRata}</div></div><div style="background: #10b981; color: white; padding: 1rem; border-radius: 20px; text-align: center;"><div style="font-size: 0.8rem; opacity: 0.8;">Tertinggi</div><div style="font-size: 1.8rem; font-weight: 700;">${nilaiTertinggi}</div></div><div style="background: #ef4444; color: white; padding: 1rem; border-radius: 20px; text-align: center;"><div style="font-size: 0.8rem; opacity: 0.8;">Terendah</div><div style="font-size: 1.8rem; font-weight: 700;">${nilaiTerendah}</div></div></div><h3 style="color: var(--navy); margin-bottom: 1rem;">Detail Nilai Harian</h3><table style="width:100%; border-collapse: collapse;"><tr style="background: var(--navy); color: white;"><th>NH₁</th><th>NH₂</th><th>NH₃</th><th>NH₄</th></tr><tr style="text-align: center;"><td>${siswa[3] || '-'} | ${siswa[4] || '-'} | ${siswa[5] || '-'}</td><td>${siswa[6] || '-'} | ${siswa[7] || '-'} | ${siswa[8] || '-'}</td><td>${siswa[9] || '-'} | ${siswa[10] || '-'} | ${siswa[11] || '-'}</td><td>${siswa[12] || '-'} | ${siswa[13] || '-'} | ${siswa[14] || '-'}</td></tr></table>`;
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'flex';
            modal.innerHTML = `<div class="modal-content" style="max-width: 600px;"><button class="close-modal" onclick="this.closest('.modal').remove()"><i class="fas fa-times"></i></button><h2><i class="fas fa-user-graduate"></i> Detail Siswa - ${siswa[1]}</h2>${detailHtml}</div>`;
            document.body.appendChild(modal);
            modal.addEventListener('click', (e) => { if (e.target === modal) modal.remove(); });
        }
        function updateInfo() {
            const total = currentData.rows.length;
            document.getElementById('totalData').innerHTML = `<i class="fas fa-users"></i> ${total}`;
            const kelasSet = new Set();
            currentData.rows.forEach(row => { if (row[2]) kelasSet.add(row[2]); });
            document.getElementById('totalKelas').innerHTML = `<i class="fas fa-layer-group"></i> ${kelasSet.size}`;
            let totalNilai = 0, count = 0;
            currentData.rows.forEach(row => { const nilai = parseFloat(row[15]); if (!isNaN(nilai)) { totalNilai += nilai; count++; } });
            const avg = count > 0 ? (totalNilai / count).toFixed(2) : '-';
            document.getElementById('rataRata').innerHTML = `<i class="fas fa-star"></i> ${avg}`;
        }
        function applyFilter() {
            const search = document.getElementById('searchNama').value.toLowerCase().trim();
            const kelas = document.getElementById('filterKelas').value;
            let filtered = originalData.rows.filter(row => { const matchNama = !search || (row[1] && row[1].toLowerCase().includes(search)); const matchKelas = kelas === 'all' || row[2] === kelas; return matchNama && matchKelas; });
            currentData.rows = filtered;
            renderTable();
            updateInfo();
            if (filtered.length !== originalData.rows.length) { showToast(`Menampilkan ${filtered.length} dari ${originalData.rows.length} siswa`); }
        }
        function resetFilter() {
            document.getElementById('searchNama').value = '';
            document.getElementById('filterKelas').value = 'all';
            currentData.rows = [...originalData.rows];
            renderTable();
            updateInfo();
            showToast('Filter direset');
        }
        const backToTopBtn = document.getElementById('backToTop');
        const tableContainer = document.getElementById('tableContainer');
        tableContainer.addEventListener('scroll', () => { if (tableContainer.scrollTop > 300) { backToTopBtn.classList.add('show'); } else { backToTopBtn.classList.remove('show'); } });
        backToTopBtn.addEventListener('click', () => { tableContainer.scrollTo({ top: 0, behavior: 'smooth' }); });
        document.addEventListener('keydown', (e) => { if (e.key === 'Escape') { document.querySelectorAll('.modal').forEach(modal => modal.remove()); } });
        let searchTimeout;
        document.getElementById('searchNama').addEventListener('input', () => { clearTimeout(searchTimeout); searchTimeout = setTimeout(applyFilter, 500); });
        document.getElementById('applyFilter').addEventListener('click', applyFilter);
        document.getElementById('resetFilter').addEventListener('click', resetFilter);
        fetchData();
        const urlParams = new URLSearchParams(window.location.search);
        const tab = urlParams.get('tab') || 'nilai';
        document.querySelector('.back-btn').href = `../guru/azh12345.html?tab=${tab}`;
        setTimeout(() => { document.querySelectorAll('.info-item').forEach((item, index) => { item.style.opacity = '0'; item.style.transform = 'translateY(20px)'; setTimeout(() => { item.style.transition = 'all 0.6s cubic-bezier(0.34, 1.56, 0.64, 1)'; item.style.opacity = '1'; item.style.transform = 'translateY(0)'; }, 100 * index); }); }, 100);
    </script>
</body>
</html>

